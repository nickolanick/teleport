---
title: Teleport's integration with Email
description: This guide explains how to setup a Email plugin for Teleport for privilege elevation approvals.
h1: Teleport Email Plugin Setup
---

This guide will talk through how to set up Teleport with Email.
Teleport's Email integration notifies individuals or mailing lists of Access Requests.

## Setup

### Prerequisites

This guide assumes that you have:

- A running Teleport Cluster
- Admin privileges with access to `tctl`
- SMTP or Mailgun credentials to send emails

Teleport Cloud requires that plugins connect through the Proxy Service (`mytenant.teleport.sh:443`).
Open Source and Enterprise installations can connect to the Auth Service (`auth.example.com:3025`) directly.

### Create a user and role for access

(!docs/pages/includes/plugins/rbac.mdx!)

### Export the access-plugin certificate

(!docs/pages/includes/plugins/identity-export.mdx!)

We'll reference these files later when [configuring the plugin](#configuring-the-teleport-email-plugin).

### Email provider

You must have an email provider to be able to send the emails.

You can either create a Mailgun account or use SMTP configuration (mode details below).

## Installing the Teleport Email plugin

We recommend installing the Teleport Plugins alongside the Teleport Proxy.
This is an ideal location as plugins have a low memory footprint, and will require both public internet access and Teleport Auth access.
We currently only provide linux-amd64 binaries, you can also compile these plugins from [source](https://github.com/gravitational/teleport-plugins/tree/master/access/email).

**Install the plugin**

<Tabs>
<TabItem label="Download">
  ```code
  $ curl -L https://get.gravitational.com/teleport-access-email-v(=teleport.version=)-linux-amd64-bin.tar.gz
  $ tar -xzf teleport-access-email-v(=teleport.version=)-linux-amd64-bin.tar.gz
  $ cd teleport-access-email
  $ ./install
  ```
</TabItem>
<TabItem label="From Source">
  To install from source you need `git` and `go >= (=teleport.golang=)` installed.

  ```code
  # Checkout teleport-plugins
  $ git clone https://github.com/gravitational/teleport-plugins.git
  $ cd teleport-plugins/access/email
  $ make
  # plugin is located at build/teleport-email
  ```
</TabItem>
</Tabs>


Run `./install` from `teleport-email` or place the executable in the appropriate `/usr/bin` or `/usr/local/bin` on the server installation.

### Configuring the Teleport Email plugin

Teleport Email uses a config file in TOML format.
Generate a boilerplate config by running the following command:

```code
$ teleport-email configure > teleport-email.toml
$ sudo mv teleport-email.toml /etc
```

#### Editing the config file

In the Teleport section, use the identity file(s) you generated with `tctl auth sign`.
The plugin installer creates a folder for those files in `/var/lib/teleport/plugins/email/`. 

Move the certificates to this folder, then edit the configuration file (`teleport-email.toml`) based on the reference below to ensure that the appropriate settings point to your identity file(s). 

<Tabs>
  <TabItem label="OpenSource, Enterprise" scope={["oss","enterprise"]}>
```conf
(!examples/resources/plugins/teleport-email.toml!)
```
</TabItem>

  <TabItem label="Cloud" scope={["cloud"]}>

```conf
(!examples/resources/plugins/teleport-email-proxy.toml!)
```
</TabItem>
</Tabs>

## Test run

Assuming that Teleport is running and the configurations are correct, you can now run the plugin and test the workflow!

```code
$ teleport-email start
```

If everything works fine, the log output should look like this:

```code
$ teleport-email start
INFO Starting Teleport Access Email Plugin 9.0.3 email/app.go:93
INFO Using Mailgun as email transport domain:REDACTED.mailgun.org email/client.go:62
INFO Plugin is ready email/app.go:114
```

### Testing the approval workflow

You can create a test permissions request with `tctl` and check if the plugin works as expected like this:

#### Create a test permissions request behalf of a user

```code
# Replace USERNAME with a Teleport local user, and TARGET_ROLE with a Teleport Role
$ tctl request create USERNAME --roles=TARGET_ROLE
```

A user can also try using `--request-roles` flag.

```code
# Example with a user trying to request a role DBA.
$ tsh login --request-roles=dba
```

#### Access the request trough the web ui

You should have receive an email containing the request, it should look something like this:
```
You have a new Role Request:

ID: 0c2e9b2b-0090-4bd8-b476-7dd81dac00d6
Cluster: ship.marco.mydemo
User: contractor
Role(s): dev
Link: https://ship.marco.mydemo/web/requests/0c2e9b2b-0090-4bd8-b476-7dd81dac00d6

Status: ‚è≥ PENDING
```

You can follow that link and approve or deny the request

### Log in and request a role

You can also test the full workflow from the user's perspective using `tsh`:

```code
# tsh login --request-roles=REQUESTED_ROLE
Seeking request approval... (id: 8f77d2d1-2bbf-4031-a300-58926237a807)
```

You should now see a new request in Teleport, and receive an email about the request with instructions.

### Set up systemd

In production, we recommend starting the Teleport plugin daemon via an init system like systemd.
Here's the recommended Teleport plugin service unit file for systemd:

```ini
(!examples/systemd/plugins/teleport-email.service!)
```

Save this as `teleport-email.service`.

## Feedback

If you have any issues with this plugin please create an [issue here](https://github.com/gravitational/teleport-plugins/issues/new).
